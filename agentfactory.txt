Agent Factory — 6 大工厂体系 PRD（最终版）
Slogan：From Zero to Agents. 目标：建立企业级 0→1 的 AI Agent 训练与部署工厂，实现智能体的工业化生产。

===============
0. 产品总体目标
构建一个可复用、可扩展、可审计的企业级 AI Agent 工厂体系，通过 6 大工厂模块，完成 Agent 从 计算 → 数据 → 环境 → 训练 → 评估 → 运行 的全链路自动化生产。
最终实现：
一种标准化、可复制、可流水线式运行的 Agent 制造系统。

===============
1. 计算工厂（Compute Factory）
提供统一的计算资源调度与抽象，支撑整个 Agent Factory 的算力需求，包括推理、训练、环境模拟。

1.1 目标
	•	提供可统一调度的 GPU / CPU / NPU / TPU 资源池。
	•	作为 6 大工厂的基础设施层。
	•	提供弹性伸缩、成本控制、资源隔离、队列调度。

1.2 功能需求
1.2.1 资源抽象与分配
	•	提供标准化的 ResourceSpec（GPU 数量、显存、带宽、加速器类型）。
	•	提供统一的资源申请接口：
	◦	推理资源池（Inference Pool）
	◦	训练资源池（Training Pool）
	◦	环境模拟资源池（Env Pool）
1.2.2 调度系统
	•	Job Queue：FIFO、优先级、多租户隔离。
	•	支持 preemptible 模型（可中断任务）。
	•	Autoscaling 自动扩缩容。
1.2.3 监控与计费
	•	资源使用监控（GPU 利用率、内存、吞吐）。
	•	按项目、按工厂统计资源消耗。
	•	产出每个 Agent 的“单次推理成本”和“训练成本”。

1.3 API
	•	POST /compute/allocate
	•	POST /compute/release
	•	GET /compute/pools
	•	GET /compute/usage

1.4 产出物
	•	统一的计算基础层，服务所有工厂。
	•	任务级调度 + 账单与可观测性。
	•	全局稳定的算力保证。

===============
2. 数据工厂（Data Factory）
负责生产、清洗、标注、管理 Agent 的训练与奖励数据资产。

2.1 目标
	•	构建任务、对话、行为、偏好、奖励等数据。
	•	支持全流程数据治理。
	•	是 Agent 训练的“原材料工厂”。

2.2 功能需求
2.2.1 数据采集
	•	采集 Agent 交互日志（Prompt、Response、Trace）。
	•	支持环境采样（rollouts）、用户数据注入。
	•	支持从运行工厂自动回写成功/失败轨迹。
2.2.2 数据清洗
	•	PII 脱敏、垃圾过滤、异常检测。
	•	支持自动聚类相似任务。
2.2.3 数据标注系统
	•	人类标注（人工评分、偏好对比）。
	•	LLM 自动标注（scoring、summaries）。
	•	LLM-as-a-judge 评分机制。
2.2.4 数据集构建与版本化
	•	Dataset versioning（D1、D2、D3…）
	•	支持多类型 dataset：SFT、RFT、RM、Eval。

2.3 API
	•	POST /data/events
	•	POST /data/label
	•	POST /datasets/create
	•	GET /datasets/{id}

2.4 产出物
	•	高质量 datasets（SFT / RFT / RM）。
	•	训练工厂可直接消费的数据资产。
	•	数据生命周期管理。

===============
3. 环境工厂（Environment Factory）
构建可重复执行的任务环境，使 Agent 可以在“可控世界”中运行、测试、采样。

3.1 目标
	•	提供安全、可模拟、可回放的任务环境。
	•	让 Agent 能在环境中“执行 → 反馈 → 学习”。

3.2 功能需求
3.2.1 环境定义
	•	支持 HTTP API Env（工具调用模拟）
	•	支持浏览器环境（Playwright）
	•	支持 RPA / App 操作环境（可扩展）
3.2.2 场景构建
	•	Prompt 场景
	•	任务链场景（multi-step）
	•	异常场景（Latency、Error Injection）
3.2.3 轨迹生成（Rollout）
	•	执行 Agent 的策略，产生 Action Trace。
	•	自动记录：
	◦	Observation
	◦	Action
	◦	Rewards（由评估工厂提供）
3.2.4 回放系统
	•	查看整个任务执行过程（Timeline）
	•	失败案例可复现

3.3 API
	•	POST /env/scenarios
	•	POST /env/run
	•	GET /env/run/{id}/trace

3.4 产出物
	•	多场景任务环境
	•	Rollout trajectories（用于训练）
	•	可对任务执行进行可视化

===============
4. 训练工厂（Training Factory）
执行模型训练、微调、强化学习，产出可用的 Agent 模型能力。

4.1 目标
	•	实现从 SFT → RFT → PPO → DPO → RFT 的完整训练链路。
	•	产出企业级专属 Agent 模型。

4.2 功能需求
4.2.1 SFT（监督微调）
	•	从数据工厂接收 SFT dataset 进行微调。
	•	支持 Adapter、LoRA、Full-finetune。
4.2.2 奖励建模（Reward Modeling）
	•	从偏好数据构建 RM 模型。
	•	支持 pairwise、scalar 奖励信号。
4.2.3 RFT / PPO 等 RL 训练
	•	通过 Environment Factory 进行 policy rollout。
	•	调用奖励模型产生 Reward。
	•	优化策略。
4.2.4 训练编排（Training Orchestrator）
	•	Job 管理（创建、暂停、恢复）
	•	Checkpoint & Model Registry

4.3 API
	•	POST /train/jobs
	•	POST /train/{job}/reward-config
	•	GET /train/{job}/status
	•	POST /models/promote

4.4 产出物
	•	训练好的 Agent 策略模型（M0 → M1 → M2 …）。
	•	Reward Model（RM）。
	•	RL 策略模型（RFT/PPO 等）。

===============
5. 评估工厂（Evaluation Factory）
提供全自动化、可量化的 Agent 质量评估、对齐评估、安全评估。

5.1 目标
	•	判断模型是否能进入生产环境。
	•	是 Agent 工厂的质量控制中心（QC）。

5.2 功能需求
5.2.1 评估任务集
	•	Manual tasks
	•	自动生成 tasks（task generator）
	•	难度分级：L1 → L5
5.2.2 多维度评估
	•	成功率（Task Success Rate）
	•	决策质量（Quality Score）
	•	工具调用成功率（Tool Accuracy）
	•	安全评估（Safety Score）
	•	幻觉率（Hallucination Score）
5.2.3 LLM-as-a-judge
	•	Auto judge responses
	•	Pairwise / rule-based scoring
5.2.4 结果可视化
	•	Benchmark Table
	•	趋势曲线（Model M0 → M1 → M2）
	•	错误案例聚类

5.3 API
	•	POST /eval/run
	•	GET /eval/results/{id}
	•	POST /eval/taskset

5.4 产出物
	•	评估报告（白名单/黑名单）
	•	问题类型分析
	•	可视化 dashboard
	•	是否可部署的判断结果（PASS / FAIL）

===============
6. 运行工厂（Runtime Factory）
负责 Agent 的部署、版本管理、安全治理与在线推理执行，是最终对外交付的产品形态。

6.1 目标
	•	将模型从训练工厂推广到生产环境。
	•	提供 Agent-as-a-Service（A级服务等级）。
	•	提供工具调用、对话、工作流执行。

6.2 功能需求
6.2.1 Agent 配置
	•	任务模板（Task Config）
	•	工具配置（Tool Registry, MCP）
	•	Memory / Context 管理
6.2.2 Session Engine
	•	Stateful / Stateless sessions
	•	Conversation state tracking
	•	Action Plan & ReAct
6.2.3 部署与版本控制
	•	Canary、灰度发布、回滚
	•	Model version locking
	•	多版本共存（A/B test）
6.2.4 运行日志与审计
	•	全链路 Trace（输入、动作、工具调用）
	•	安全审查（PII 检测）

6.3 API
	•	POST /agents
	•	POST /agents/{id}/sessions
	•	POST /agents/{id}/sessions/{sid}/step
	•	POST /agents/{id}/deploy

6.4 产出物
	•	在线可运行的 Agent（API、Bot、Workflow）。
	•	调用日志 → 自动回流 → 数据工厂。
	•	企业级服务 SLA。

===============
7. 端到端工厂链路总览

【Compute】
   ↓
【Data Factory】
   ↓
【Environment Factory】
   ↓
【Training Factory】
   ↓
【Evaluation Factory】
   ↓ PASS →
【Runtime Factory】 → 用户与应用使用
            ↑
            |（回流：执行轨迹）
            └── 数据工厂

===============
8. MVP 阶段（推荐 2–3 个月）
1）必须上线的工厂
	•	计算工厂（基础层）
	•	数据工厂（最关键的数据资产）
	•	环境工厂（任务模拟）
	•	训练工厂（SFT + RFT）
	•	评估工厂（简单成功率）
	•	运行工厂（基本 Session + 工具调用）
2）最小可用能力
	•	支持从数据 → 环境 → 训练 → 评估 → 运行的一次完整循环。
	•	能够产生一个可用的企业级 agent。

===============
9. 成功指标（KPI）
	•	训练周期缩短 > 50%
	•	任务成功率提升 > 30%
	•	工具调用成功率 > 80%
	•	agent 出厂周期 ≤ 72 小时
	•	生产环境 SLA ≥ 99.9%
